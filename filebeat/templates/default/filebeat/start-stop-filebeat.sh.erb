#!/sbin/sh
# This file was generated by Chef for <%= node['fqdn'] %>.
# Do not modify this file by hand!
#

NAME=<%= @name %>

PIDFILE="/var/run/${NAME}.pid"
DAEMON=<%= @daemon_path %>
ARGS="-c <%= @conf_path %> <%= node['filebeat']['service']['additional_command_line_options'] %>"

start() {
    echo -n $"Starting $NAME: "
    nohup $DAEMON $ARGS -v > /dev/null 2>&1 &
    PID=$!
    if [ -z $PID ]; then
        printf "%s\n" "Failed to start $NAME"
        exit 2
    else
        echo $PID > $PIDFILE
        printf "%s\n" "Success"
    fi
}

stop() {
    if status ; then
      echo -n $"Stopping $NAME: "
      pid=$(cat $PIDFILE)
      kill $pid
      retval=$?
      echo
      [ $retval -eq 0 ] && rm -f $PIDFILE
      return $retval
    else
       echo "$NAME not running"
    fi
}

status() {
  if [ -f "$PIDFILE" ] ; then
    pid=`cat "$PIDFILE"`
    if kill -0 $pid > /dev/null 2> /dev/null ; then
      # process by this pid is running.
      # It may not be our pid, but that's what you get with just pidfiles.
      return 0
    else
      return 2 # program is dead but pid file exists
    fi
  else
    return 3 # program is not running
  fi
}

case "$1" in
    start)
        $1
	;;
     stop)
        $1
	;;
esac
